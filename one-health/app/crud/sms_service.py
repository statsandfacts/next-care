from __future__ import print_function

import logging
import string
import random
import sib_api_v3_sdk
import http.client
import urllib.parse
import ssl
import certifi
from sib_api_v3_sdk.rest import ApiException
from app.core.ConfigServiceTemplate import ConfigServiceTemplate

from starlette.responses import JSONResponse

logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)

base_url = "/api/mt/SendSMS"
config_file_path = "/app/notification_config.ini"
config_service = ConfigServiceTemplate(config_file_path)

sms_config = config_service.get_sms_config()
email_config = config_service.get_email_config()
params = sms_config

def send_otp(phone_number: str, email_id: str):
    verification_code = ''.join(random.sample(string.digits, k=6))
    if not email_id:
        sms_config['number'] = phone_number
        new_text = sms_config['text'].replace('VAR', verification_code)
        sms_config['text'] = new_text
        return send_otp_to_phone(verification_code)
    else:
        sms_config['number'] = phone_number
        new_text = sms_config['text'].replace('VAR', verification_code)
        sms_config['text'] = new_text
        response_sms = send_otp_to_phone(verification_code)
        response_mail = send_otp_to_mail(email_id, verification_code)

        if response_mail.status_code == 500 and response_sms.status_code == 500:
            return JSONResponse(content={"message": "failed to send otp to user", "status": 500}, status_code=500)
        return JSONResponse(
            content={"message": "Otp sent to your mail address and phone number", "status": 200,
                     "verification_code": verification_code},
            status_code=200)


def send_otp_to_phone(verification_code:str):
    # Encode the parameters
    encoded_params = urllib.parse.urlencode(sms_config)

    # Create the full URL
    url = f"{base_url}?{encoded_params}"
    host = "www.smsgatewayhub.com"

    # Create an SSL context using certifi
    context = ssl.create_default_context(cafile=certifi.where())

    try:
        # Establish connection with a timeout and custom SSL context
        conn = http.client.HTTPSConnection(host, context=context, timeout=10)

        # Send GET request
        conn.request("GET", url)

        # Get response
        response = conn.getresponse()

        # Check if request was successful
        if response.status == 200:
            return JSONResponse(
                content={"message": "Otp sent to user's phone number", "status": 200,
                         "verification_code": verification_code},
                status_code=200)
        else:
            print(f"Failed to send SMS to user. Status code: {response.status}")
            return JSONResponse(
                content={"message": f"Failed to send SMS to user. Status code: {response.status}", "status": response.status},
                status_code=response.status)

    except (socket.timeout, socket.gaierror) as e:
        logger.error(f"Network error: {e}")
    except http.client.HTTPException as e:
        logger.error(f"HTTP error: {e}")
    except Exception as e:
        logger.error(f"An unexpected error occurred: {e}")
    finally:
        # Close connection if it was successfully established
        try:
            conn.close()
        except NameError:
            pass  # conn was never created due to an error


def send_otp_to_mail(email_id: str, verification_code: str):

    configuration = sib_api_v3_sdk.Configuration()
    configuration.api_key[
        'api-key'] = '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'

    api_instance = sib_api_v3_sdk.TransactionalEmailsApi(sib_api_v3_sdk.ApiClient(configuration))
    subject = "Welcome to Next Care!"
    sender = {'name': 'Next Care', 'email': 'nextcare.life@gmail.com'}
    to = [{'email': email_id}]
    cc = [{"email": "sales.statsandfacts@gmail.com", "name": "Stats and Facts"}]
    #bcc = [{"name": "test", "email": "test"}]
    reply_to = {'email': 'nextcare.life@gmail.com', 'name': 'Next Care'}
    headers = {
        "X-Mailin-custom": "custom_header_1:custom_value_1|custom_header_2:custom_value_2|custom_header_3:custom_value_3",
        "charset": "iso-8859-1"}
    html_content = "<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Strict//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd\">\n<html xmlns=\"http://www.w3.org/1999/xhtml\" xmlns:v=\"urn:schemas-microsoft-com:vml\" xmlns:o=\"urn:schemas-microsoft-com:office:office\"><head><meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\"><meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\"><meta name=\"format-detection\" content=\"telephone=no\"><meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"><title>OTP Generated</title><style type=\"text/css\" emogrify=\"no\">#outlook a { padding:0; } .ExternalClass { width:100%; } .ExternalClass, .ExternalClass p, .ExternalClass span, .ExternalClass font, .ExternalClass td, .ExternalClass div { line-height: 100%; } table td { border-collapse: collapse; mso-line-height-rule: exactly; } .editable.image { font-size: 0 !important; line-height: 0 !important; } .nl2go_preheader { display: none !important; mso-hide:all !important; mso-line-height-rule: exactly; visibility: hidden !important; line-height: 0px !important; font-size: 0px !important; } body { width:100% !important; -webkit-text-size-adjust:100%; -ms-text-size-adjust:100%; margin:0; padding:0; } img { outline:none; text-decoration:none; -ms-interpolation-mode: bicubic; } a img { border:none; } table { border-collapse:collapse; mso-table-lspace:0pt; mso-table-rspace:0pt; } th { font-weight: normal; text-align: left; } *[class=\"gmail-fix\"] { display: none !important; } </style><style type=\"text/css\" emogrify=\"no\"> @media (max-width: 600px) { .gmx-killpill { content: ' \\03D1';} } </style><style type=\"text/css\" emogrify=\"no\">@media (max-width: 600px) { .gmx-killpill { content: ' \\03D1';} .r0-o { border-style: solid !important; margin: 0 auto 0 auto !important; width: 100% !important } .r1-i { background-color: transparent !important } .r2-c { box-sizing: border-box !important; text-align: center !important; valign: top !important; width: 320px !important } .r3-o { border-style: solid !important; margin: 0 auto 0 auto !important; width: 320px !important } .r4-i { padding-bottom: 5px !important; padding-top: 5px !important } .r5-c { box-sizing: border-box !important; display: block !important; valign: top !important; width: 100% !important } .r6-o { border-style: solid !important; width: 100% !important } .r7-i { padding-left: 0px !important; padding-right: 0px !important } .r8-c { box-sizing: border-box !important; padding-left: 10px !important; padding-right: 10px !important; padding-top: 15px !important; text-align: center !important; width: 100% !important } .r9-i { background-color: #ffffff !important } .r10-c { box-sizing: border-box !important; text-align: center !important; valign: top !important; width: 100% !important } .r11-i { padding-bottom: 20px !important; padding-left: 15px !important; padding-right: 15px !important; padding-top: 20px !important } .r12-i { padding-left: 20px !important; padding-right: 20px !important; padding-top: 20px !important } .r13-o { border-style: solid !important; margin: 0 auto 0 0 !important; width: 100% !important } .r14-i { text-align: left !important } .r15-i { padding-top: 10px !important; text-align: left !important } .r16-i { padding-left: 20px !important; padding-right: 20px !important; padding-top: 30px !important } .r17-i { padding-top: 15px !important; text-align: left !important } .r18-o { border-style: solid !important; margin: 0 auto 0 auto !important; margin-top: 40px !important; width: 100% !important } .r19-i { background-color: #e1e1e1 !important } .r20-i { padding-bottom: 20px !important; padding-left: 10px !important; padding-right: 10px !important; padding-top: 20px !important } .r21-o { border-style: solid !important; margin-left: 0px !important; width: 100% !important } .r22-c { box-sizing: border-box !important; text-align: left !important; valign: top !important; width: 100% !important } .r23-c { box-sizing: border-box !important; padding-top: 35px !important; text-align: left !important; valign: top !important; width: 100% !important } .r24-c { box-sizing: border-box !important; text-align: left !important; width: 100% !important } .r25-i { font-size: 0px !important; padding-left: 0px !important; padding-right: 152px !important; padding-top: 15px !important } .r26-c { box-sizing: border-box !important; width: 32px !important } .r27-o { border-style: solid !important; margin-right: 5px !important; width: 32px !important } body { -webkit-text-size-adjust: none } .nl2go-responsive-hide { display: none } .nl2go-body-table { min-width: unset !important } .mobshow { height: auto !important; overflow: visible !important; max-height: unset !important; visibility: visible !important; border: none !important } .resp-table { display: inline-table !important } .magic-resp { display: table-cell !important } } </style><style type=\"text/css\">p, h1, h2, h3, h4, ol, ul, li { margin: 0; } a, a:link { color: #3f3d56; text-decoration: none } .nl2go-default-textstyle { color: #3f3d56; font-family: Montserrat, Arial, Helvetica, sans-serif; font-size: 20px; line-height: 1.4; word-break: break-word } .default-button { color: #ffffff; font-family: Montserrat, Arial, Helvetica, sans-serif; font-size: 20px; font-style: normal; font-weight: bold; line-height: 1.15; text-decoration: none; word-break: break-word } .sib_class_16_black_reg { color: #434343; font-family: Montserrat, Arial, Helvetica, sans-serif; font-size: 16px; word-break: break-word } .sib_class_16_black_b { color: #434343; font-family: Montserrat, Arial, Helvetica, sans-serif; font-size: 16px; font-weight: 700; word-break: break-word } .sib_class_20_white_b { color: #ffffff; font-family: Montserrat, Arial, Helvetica, sans-serif; font-size: 20px; font-weight: 700; word-break: break-word } .sib_class_28_black_reg { color: #434343; font-family: Montserrat, Arial, Helvetica, sans-serif; font-size: 28px; word-break: break-word } .sib_class_26_black_b { color: #434343; font-family: Montserrat, Arial, Helvetica, sans-serif; font-size: 26px; font-weight: 700; word-break: break-word } .sib_class_35_black_b { color: #434343; font-family: Montserrat, Arial, Helvetica, sans-serif; font-size: 35px; font-weight: 700; word-break: break-word } .sib_class_50_black_b { color: #434343; font-family: Montserrat, Arial, Helvetica, sans-serif; font-size: 50px; font-weight: 700; word-break: break-word } .sib_class_70_black_reg { color: #434343; font-family: Montserrat, Arial, Helvetica, sans-serif; font-size: 70px; word-break: break-word } .nl2go_class_impressum { color: #999999; font-family: Montserrat, Arial, Helvetica, sans-serif; font-size: 12px; font-style: italic; word-break: break-word } .default-heading1 { color: #434343; font-family: Montserrat, Arial, Helvetica, sans-serif; font-size: 50px; word-break: break-word } .default-heading2 { color: #434343; font-family: Montserrat, Arial, Helvetica, sans-serif; font-size: 35px; word-break: break-word } .default-heading3 { color: #434343; font-family: Montserrat, Arial, Helvetica, sans-serif; font-size: 26px; word-break: break-word } .default-heading4 { color: #434343; font-family: Montserrat, Arial, Helvetica, sans-serif; font-size: 18px; word-break: break-word } a[x-apple-data-detectors] { color: inherit !important; text-decoration: inherit !important; font-size: inherit !important; font-family: inherit !important; font-weight: inherit !important; line-height: inherit !important; } .no-show-for-you { border: none; display: none; float: none; font-size: 0; height: 0; line-height: 0; max-height: 0; mso-hide: all; overflow: hidden; table-layout: fixed; visibility: hidden; width: 0; } </style><!--[if mso]><xml> <o:OfficeDocumentSettings> <o:AllowPNG/> <o:PixelsPerInch>96</o:PixelsPerInch> </o:OfficeDocumentSettings> </xml><![endif]--><style type=\"text/css\">a:link{color: #3f3d56; text-decoration: none;}</style></head><body bgcolor=\"#ffffff\" text=\"#3f3d56\" link=\"#3f3d56\" yahoo=\"fix\" style=\"background-color: #ffffff;\"> <table cellspacing=\"0\" cellpadding=\"0\" border=\"0\" role=\"presentation\" class=\"nl2go-body-table\" width=\"100%\" style=\"background-color: #ffffff; width: 100%;\"><tr><td> <table cellspacing=\"0\" cellpadding=\"0\" border=\"0\" role=\"presentation\" width=\"100%\" align=\"center\" class=\"r0-o\" style=\"table-layout: fixed; width: 100%;\"><tr><td valign=\"top\" class=\"r1-i\" style=\"background-color: transparent;\"> <table cellspacing=\"0\" cellpadding=\"0\" border=\"0\" role=\"presentation\" width=\"600\" align=\"center\" class=\"r3-o\" style=\"table-layout: fixed;\"><tr><td class=\"r4-i\" style=\"padding-bottom: 5px; padding-top: 5px;\"> <table width=\"100%\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" role=\"presentation\"><tr><th width=\"100%\" valign=\"top\" class=\"r5-c\" style=\"font-weight: normal;\"> <table cellspacing=\"0\" cellpadding=\"0\" border=\"0\" role=\"presentation\" width=\"100%\" class=\"r6-o\" style=\"table-layout: fixed; width: 100%;\"><tr><td valign=\"top\" class=\"r7-i\" style=\"padding-left: 10px; padding-right: 10px;\"> <table width=\"100%\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" role=\"presentation\"><tr><td class=\"r8-c nl2go-default-textstyle\" align=\"center\" style=\"color: #3f3d56; font-family: Montserrat,Arial,Helvetica,sans-serif; font-size: 20px; line-height: 1.4; word-break: break-word; padding-left: 30px; padding-right: 30px; padding-top: 15px; text-align: center;\"> <div><p style=\"margin: 0;\"><a href=\"{{ mirror }}\" style=\"color: #3f3d56; text-decoration: none;\"><span style=\"font-size: 12px;\">View in browser</span></a></p></div> </td> </tr></table></td> </tr></table></th> </tr></table></td> </tr></table></td> </tr></table><table cellspacing=\"0\" cellpadding=\"0\" border=\"0\" role=\"presentation\" width=\"600\" align=\"center\" class=\"r3-o\" style=\"table-layout: fixed; width: 600px;\"><tr><td valign=\"top\" class=\"r9-i\" style=\"background-color: #ffffff;\"> <table cellspacing=\"0\" cellpadding=\"0\" border=\"0\" role=\"presentation\" width=\"100%\" align=\"center\" class=\"r0-o\" style=\"table-layout: fixed; width: 100%;\"><tr><td class=\"r11-i\" style=\"padding-bottom: 20px; padding-top: 20px;\"> <table width=\"100%\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" role=\"presentation\"><tr><th width=\"100%\" valign=\"top\" class=\"r5-c\" style=\"font-weight: normal;\"> <table cellspacing=\"0\" cellpadding=\"0\" border=\"0\" role=\"presentation\" width=\"100%\" class=\"r6-o\" style=\"table-layout: fixed; width: 100%;\"><tr><td valign=\"top\" class=\"r7-i\" style=\"padding-left: 10px; padding-right: 10px;\"> <table width=\"100%\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" role=\"presentation\"><tr><td class=\"r10-c\" align=\"center\"> <table cellspacing=\"0\" cellpadding=\"0\" border=\"0\" role=\"presentation\" width=\"200\" class=\"r0-o\" style=\"table-layout: fixed; width: 200px;\"><tr><td style=\"font-size: 0px; line-height: 0px;\"> <img src=\"https://img.mailinblue.com/7592066/images/content_library/original/662d16dfc46dd8090804ee89.png\" width=\"200\" border=\"0\" style=\"display: block; width: 100%;\"></td> </tr></table></td> </tr></table></td> </tr></table></th> </tr></table></td> </tr></table><table cellspacing=\"0\" cellpadding=\"0\" border=\"0\" role=\"presentation\" width=\"100%\" align=\"center\" class=\"r0-o\" style=\"table-layout: fixed; width: 100%;\"><tr><td class=\"r12-i\" style=\"padding-top: 55px;\"> <table width=\"100%\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" role=\"presentation\"><tr><th width=\"100%\" valign=\"top\" class=\"r5-c\" style=\"font-weight: normal;\"> <table cellspacing=\"0\" cellpadding=\"0\" border=\"0\" role=\"presentation\" width=\"100%\" align=\"left\" class=\"r13-o\" style=\"table-layout: fixed; width: 100%;\"><tr><td align=\"left\" valign=\"top\" class=\"r14-i nl2go-default-textstyle\" style=\"color: #3f3d56; font-family: Montserrat,Arial,Helvetica,sans-serif; font-size: 20px; line-height: 1.4; word-break: break-word; text-align: left;\"> <div><div class=\"sib_class_28_black_reg\" style=\"color: #434343; font-family: Montserrat,Arial,Helvetica,sans-serif; font-size: 28px; word-break: break-word;\">. . . just a little bit more</div></div> </td> </tr></table><table cellspacing=\"0\" cellpadding=\"0\" border=\"0\" role=\"presentation\" width=\"100%\" align=\"left\" class=\"r13-o\" style=\"table-layout: fixed; width: 100%;\"><tr><td align=\"left\" valign=\"top\" class=\"r15-i nl2go-default-textstyle\" style=\"color: #3f3d56; font-family: Montserrat,Arial,Helvetica,sans-serif; font-size: 20px; word-break: break-word; line-height: 1.3; padding-top: 10px; text-align: left;\"> <div><h2 class=\"default-heading2\" style=\"margin: 0; color: #434343; font-family: Montserrat,Arial,Helvetica,sans-serif; font-size: 35px; word-break: break-word;\">You are almost there!</h2></div> </td> </tr></table></th> </tr></table></td> </tr></table><table cellspacing=\"0\" cellpadding=\"0\" border=\"0\" role=\"presentation\" width=\"100%\" align=\"center\" class=\"r0-o\" style=\"table-layout: fixed; width: 100%;\"><tr><td class=\"r12-i\" style=\"padding-top: 50px;\"> <table width=\"100%\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" role=\"presentation\"><tr><th width=\"100%\" valign=\"top\" class=\"r5-c\" style=\"font-weight: normal;\"> <table cellspacing=\"0\" cellpadding=\"0\" border=\"0\" role=\"presentation\" width=\"600\" align=\"center\" class=\"r0-o\" style=\"table-layout: fixed; width: 600px;\"><tr><td class=\"r7-i\" style=\"font-size: 0px; line-height: 0px;\"> <img src=\"http://img-st2.mailinblue.com/2037886/images/rnb/original/5e8b17962b8ec7020d7c2f85.png\" width=\"600\" border=\"0\" style=\"display: block; width: 100%;\"></td> </tr></table></th> </tr></table></td> </tr></table><table cellspacing=\"0\" cellpadding=\"0\" border=\"0\" role=\"presentation\" width=\"100%\" align=\"center\" class=\"r0-o\" style=\"table-layout: fixed; width: 100%;\"><tr><td class=\"r16-i\" style=\"padding-top: 60px;\"> <table width=\"100%\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" role=\"presentation\"><tr><th width=\"100%\" valign=\"top\" class=\"r5-c\" style=\"font-weight: normal;\"> <table cellspacing=\"0\" cellpadding=\"0\" border=\"0\" role=\"presentation\" width=\"100%\" align=\"left\" class=\"r13-o\" style=\"table-layout: fixed; width: 100%;\"><tr><td align=\"left\" valign=\"top\" class=\"r14-i nl2go-default-textstyle\" style=\"color: #3f3d56; font-family: Montserrat,Arial,Helvetica,sans-serif; font-size: 20px; line-height: 1.4; word-break: break-word; text-align: left;\"> <div><h3 class=\"default-heading3\" style=\"margin: 0; color: #434343; font-family: Montserrat,Arial,Helvetica,sans-serif; font-size: 26px; word-break: break-word;\">Dear User,</h3></div> </td> </tr></table><table cellspacing=\"0\" cellpadding=\"0\" border=\"0\" role=\"presentation\" width=\"100%\" align=\"left\" class=\"r13-o\" style=\"table-layout: fixed; width: 100%;\"><tr><td align=\"left\" valign=\"top\" class=\"r17-i nl2go-default-textstyle\" style=\"color: #3f3d56; font-family: Montserrat,Arial,Helvetica,sans-serif; font-size: 20px; line-height: 1.4; word-break: break-word; padding-top: 15px; text-align: left;\"> <div><p style=\"margin: 0;\">Please use account verification code <strong>"+ verification_code +"</strong> to verify your mobile number to get signed up.</p></div> </td> </tr></table></th> </tr></table></td> </tr></table></td> </tr></table><table cellspacing=\"0\" cellpadding=\"0\" border=\"0\" role=\"presentation\" width=\"100%\" align=\"center\" class=\"r18-o\" style=\"table-layout: fixed; width: 100%;\"><tr class=\"nl2go-responsive-hide\"><td height=\"120\" style=\"font-size: 120px; line-height: 120px;\">­</td> </tr><tr><td valign=\"top\" class=\"r19-i\" style=\"background-color: #e1e1e1;\"> <table cellspacing=\"0\" cellpadding=\"0\" border=\"0\" role=\"presentation\" width=\"600\" align=\"center\" class=\"r3-o\" style=\"table-layout: fixed; width: 600px;\"><tr><td class=\"r20-i\" style=\"padding-bottom: 55px; padding-left: 65px; padding-right: 40px; padding-top: 70px;\"> <table width=\"100%\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" role=\"presentation\"><tr><th width=\"58.33%\" valign=\"top\" class=\"r5-c\" style=\"font-weight: normal;\"> <table cellspacing=\"0\" cellpadding=\"0\" border=\"0\" role=\"presentation\" width=\"100%\" class=\"r21-o\" style=\"table-layout: fixed; width: 100%;\"><tr><td valign=\"top\" class=\"r7-i\" style=\"padding-left: 10px; padding-right: 10px;\"> <table width=\"100%\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" role=\"presentation\"><tr><td class=\"r22-c nl2go-default-textstyle\" align=\"left\" style=\"color: #3f3d56; font-family: Montserrat,Arial,Helvetica,sans-serif; font-size: 20px; word-break: break-word; line-height: 1.6; text-align: left; valign: top;\"> <div><div class=\"sib_class_16_black_reg\" style=\"color: #434343; font-family: Montserrat,Arial,Helvetica,sans-serif; font-size: 16px; word-break: break-word;\"><strong>nextcare.life</strong></div><div class=\"sib_class_16_black_reg\" style=\"color: #434343; font-family: Montserrat,Arial,Helvetica,sans-serif; font-size: 16px; word-break: break-word;\">Bhubaneswar, Odisha<br>751021 Bhubneswar<br><a href=\"http://\" style=\"color: #3f3d56; text-decoration: none;\"><span style=\"font-size: 16px;\">contact@company.com</span></a></div></div> </td> </tr></table></td> </tr></table></th> <th width=\"41.67%\" valign=\"top\" class=\"r5-c\" style=\"font-weight: normal;\"> <table cellspacing=\"0\" cellpadding=\"0\" border=\"0\" role=\"presentation\" width=\"100%\" class=\"r6-o\" style=\"table-layout: fixed; width: 100%;\"><tr><td valign=\"top\" class=\"r7-i\" style=\"padding-left: 10px; padding-right: 10px;\"> <table width=\"100%\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" role=\"presentation\"><tr><td class=\"r23-c nl2go-default-textstyle\" align=\"left\" style=\"color: #3f3d56; font-family: Montserrat,Arial,Helvetica,sans-serif; font-size: 20px; line-height: 1.4; word-break: break-word; text-align: left; valign: top;\"> <div><div class=\"sib_class_16_black_b\" style=\"color: #434343; font-family: Montserrat,Arial,Helvetica,sans-serif; font-size: 16px; font-weight: 700; word-break: break-word;\">Find us</div></div> </td> </tr><tr><td class=\"r24-c\" align=\"left\"> <table cellspacing=\"0\" cellpadding=\"0\" border=\"0\" role=\"presentation\" width=\"186\" align=\"left\" class=\"r13-o\" style=\"table-layout: fixed; width: 186px;\"><tr><td valign=\"top\"> <table width=\"100%\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" role=\"presentation\"><tr><td class=\"r24-c\" align=\"left\" style=\"display: inline-block;\"> <table cellspacing=\"0\" cellpadding=\"0\" border=\"0\" role=\"presentation\" width=\"186\" align=\"left\" class=\"r13-o\" style=\"table-layout: fixed; width: 186px;\"><tr><td class=\"r25-i\" style=\"padding-right: 26px; padding-top: 15px;\"> <table width=\"100%\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\" role=\"presentation\"><tr><th width=\"40\" class=\"r26-c mobshow resp-table\" style=\"font-weight: normal;\"> <table cellspacing=\"0\" cellpadding=\"0\" border=\"0\" role=\"presentation\" width=\"100%\" class=\"r27-o\" style=\"table-layout: fixed; width: 100%;\"><tr><td style=\"font-size: 0px; line-height: 0px;\"> <img src=\"https://creative-assets.mailinblue.com/editor/social-icons/rounded_colored/facebook_32px.png\" width=\"32\" border=\"0\" style=\"display: block; width: 100%;\"></td> <td class=\"nl2go-responsive-hide\" width=\"8\" style=\"font-size: 0px; line-height: 1px;\">­ </td> </tr></table></th> <th width=\"40\" class=\"r26-c mobshow resp-table\" style=\"font-weight: normal;\"> <table cellspacing=\"0\" cellpadding=\"0\" border=\"0\" role=\"presentation\" width=\"100%\" class=\"r27-o\" style=\"table-layout: fixed; width: 100%;\"><tr><td style=\"font-size: 0px; line-height: 0px;\"> <img src=\"https://creative-assets.mailinblue.com/editor/social-icons/rounded_colored/linkedin_32px.png\" width=\"32\" border=\"0\" style=\"display: block; width: 100%;\"></td> <td class=\"nl2go-responsive-hide\" width=\"8\" style=\"font-size: 0px; line-height: 1px;\">­ </td> </tr></table></th> <th width=\"40\" class=\"r26-c mobshow resp-table\" style=\"font-weight: normal;\"> <table cellspacing=\"0\" cellpadding=\"0\" border=\"0\" role=\"presentation\" width=\"100%\" class=\"r27-o\" style=\"table-layout: fixed; width: 100%;\"><tr><td style=\"font-size: 0px; line-height: 0px;\"> <img src=\"https://creative-assets.mailinblue.com/editor/social-icons/rounded_colored/twitter_32px.png\" width=\"32\" border=\"0\" style=\"display: block; width: 100%;\"></td> <td class=\"nl2go-responsive-hide\" width=\"8\" style=\"font-size: 0px; line-height: 1px;\">­ </td> </tr></table></th> <th width=\"40\" class=\"r26-c mobshow resp-table\" style=\"font-weight: normal;\"> <table cellspacing=\"0\" cellpadding=\"0\" border=\"0\" role=\"presentation\" width=\"100%\" class=\"r27-o\" style=\"table-layout: fixed; width: 100%;\"><tr><td style=\"font-size: 0px; line-height: 0px;\"> <img src=\"https://creative-assets.mailinblue.com/editor/social-icons/rounded_colored/youtube_32px.png\" width=\"32\" border=\"0\" style=\"display: block; width: 100%;\"></td> <td class=\"nl2go-responsive-hide\" width=\"8\" style=\"font-size: 0px; line-height: 1px;\">­ </td> </tr></table></th> </tr></table></td> </tr></table></td> </tr></table></td> </tr></table></td> </tr></table></td> </tr></table></th> </tr></table></td> </tr></table></td> </tr></table></td> </tr></table></body></html>\n"
    send_smtp_email = sib_api_v3_sdk.SendSmtpEmail(to=to, cc=cc, reply_to=reply_to,
                                                   headers=headers, sender=sender, subject=subject, html_content = html_content)

    try:
        api_instance.send_transac_email(send_smtp_email)
        return JSONResponse(content={"message": "Otp sent to user mail address", "status": 200}, status_code=200)
    except ApiException as e:
        return JSONResponse(content={"message": "failed to send otp to user mail address", "status": 500},
                            status_code=500)
